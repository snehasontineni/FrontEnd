var data = {
    "_organization_logo": "https://s3-ap-southeast-1.amazonaws.com/com.loktra.avatars/u_bony@loktra.com",
    "_current_user": {
        "_avatar": "https://s3-ap-southeast-1.amazonaws.com/com.loktra.avatars/u_bony@loktra.com",
        "_email": "bony@loktra.com",
        "_employee_id": "E103",
        "_id": "b5b7b5e1-9101-4526-995f-b93fe2142b60",
        "_joined_since": "2016-12-26T13:34:34.784013Z",
        "_joined_since_date": "Dec 26 2016",
        "_name": "Bony Roopchandani",
        "_phone": "+918233085557",
        "_user_roles": [
            "manager",
            "agent"
        ]
    },
    "_members": [
        {
            "_id": "118e2390-6efb-4ca5-960c-736408738378",
            "_name": "Bishwash Kumara",
            "_avatar": "https://s3-ap-southeast-1.amazonaws.com/com.loktra.avatars/u_bony@loktra.com",
            "_user_roles": [
                "agent"
            ],
            "_status": "ONLINE",
            "_last_location": [12.9567083, 77.709295]
        },
        {
            "_id": "118e2390-6efb-4ca5-960c-736408738378",
            "_name": "Stephen McCurry",
            "_avatar": "https://s3-ap-southeast-1.amazonaws.com/com.loktra.avatars/u_bony@loktra.com",
            "_user_roles": [
                "agent"
            ],
            "_status": "INACTIVE",
            "_last_location": null
        },
        {
            "_id": "118e2390-6efb-4ca5-960c-736408738378",
            "_name": "Tania Saha",
            "_avatar": null,
            "_user_roles": [
                "agent"
            ],
            "_status": "OFFLINE",
            "_last_location": [12.9567083, 77.709295]
        },
        {
            "_id": "118e2390-6efb-4ca5-960c-736408738378",
            "_name": "Ajaykumar Srinivas",
            "_avatar": "https://s3-ap-southeast-1.amazonaws.com/com.loktra.avatars/u_bony@loktra.com",
            "_user_roles": [
                "manager",
                "agent"
            ],
            "_status": "INACTIVE",
            "_last_location": null
        },
        {
            "_id": "118e2390-6efb-4ca5-960c-736408738378",
            "_name": "Srinivas Manjunathan",
            "_avatar": null,
            "_user_roles": [
                "manager",
                "agent",
                "admin"
            ],
            "_status": "ONLINE",
            "_last_location": [12.9567083, 77.709295]
        }
    ],
    "_tasks": {
        "_count": {
            "_total": 10,
            "_assigned": 7,
            "_unassigned": 3
        },
        "_list": {
            "_assigned": [
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "PENDING",
                    "_customer_location": [12.9567083, 77.709295]
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "FAILED",
                    "_customer_location": null
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "COMPLETED",
                    "_customer_location": null
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "FAILED",
                    "_customer_location": [12.9567083, 77.709295]
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "STARTED",
                    "_customer_location": null
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "PENDING",
                    "_customer_location": [12.9567083, 77.709295]
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "FAILED",
                    "_customer_location": null
                }
            ],
            "_unassigned": [
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "PENDING",
                    "_customer_location": null
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "PENDING",
                    "_customer_location": [12.9567083, 77.709295]
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "PENDING",
                    "_customer_location": null
                }
            ]
        }
    },
    "_navigation_details": [
        {
            "_group_details": {
                "_path": ["Sales"],
                "_tree": {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "Sales",
                    "_tree": [
                        {
                            "_id": "118e2390-6efb-4ca5-960c-736408738378",
                            "_name": "Finance Sales",
                            "_tree": null
                        },
                        {
                            "_id": "118e2390-6efb-4ca5-960c-736408738378",
                            "_name": "Management Sales",
                            "_tree": null
                        }
                    ]
                }
            },
            "_place_details": {
                "_path": ["Pan India"],
                "_tree": {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "Pan India",
                    "_tree": [
                        {
                            "_id": "118e2390-6efb-4ca5-960c-736408738378",
                            "_name": "North India",
                            "_tree": [
                                {
                                    "_name": "Rajasthan",
                                    "_tree": null
                                }
                            ]
                        },
                        {
                            "_id": "118e2390-6efb-4ca5-960c-736408738378",
                            "_name": "South India",
                            "_tree": [
                                {
                                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                                    "_name": "Karnataka",
                                    "_tree": [
                                        {
                                            "_id": "118e2390-6efb-4ca5-960c-736408738378",
                                            "_name": "Bengaluru",
                                            "_tree": null
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            }
        },
        {
            "_group_details": {
                "_path": ["Marketing"],
                "_tree": {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "Marketing",
                    "_tree": null
                }
            },
            "_place_details": {
                "_path": ["Maharashtra"],
                "_tree": {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "Mumbai",
                    "_tree": null
                }
            }
        }
    ]
};
var online_click_value = 'yes';
var offline_click_value = 'yes';
var unavailable_click_value = 'yes';
var click_status_value = '';

function selected_filter_handler(status_value)
{
    $('#select_chat_widget').html('');
    var selected_value = $('#filter_type').val();
    var validate_filter = selected_value.toLowerCase();
    var online_count = 0;
    var offline_count = 0;
    var unavailable_count = 0;
    for (var i = 0; i < data._members.length; i++) 
    {
        var chat_row = document.createElement('div');
        $(chat_row).addClass('row chat');
        var img_col = document.createElement('div');
        $(img_col).addClass('col-md-2 col-lg-2 img_col');
        var img_element = document.createElement('img');
        $(img_element).addClass('img-circle img-responsive img-center chat_img');
        $(img_element).attr('src', data._members[i]._avatar);
        $(img_col).append(img_element);
        var parent_circle = document.createElement('div');
        $(parent_circle).addClass('parent_circle_round');
        $(img_col).append(parent_circle);
        var circle_element = document.createElement('div');
        $(circle_element).addClass('circle_round');
        var status_value_lower = data._members[i]._status;
        status_value_lower = status_value_lower.toLowerCase();
        if(status_value_lower == 'inactive')
           status_value_lower = 'unavailable';
        if(data._members[i]._status == 'ONLINE')
        {
            online_count++;
            $(circle_element).addClass('online');
        }
        else if(data._members[i]._status == 'OFFLINE')
        {
            offline_count++;
            $(circle_element).addClass('offline');
        }
        else if(data._members[i]._status == 'INACTIVE')
        { 
             unavailable_count++;
             $(circle_element).addClass('unavailable');
        }
        $(img_col).append(circle_element);
        $(chat_row).append(img_col);
        var name_col = document.createElement('div');
        $(name_col).addClass('col-md-10 col-lg-10 name_col');
        var cust_name_row = document.createElement('div');
        $(cust_name_row).addClass('row cust_chat_name');
        $(cust_name_row).html(data._members[i]._name);
        $(name_col).append(cust_name_row);
        var cust_agent_type = document.createElement('div');
        $(cust_agent_type).addClass('row cust_chat_agent');
        var valid_type = 'no';
        var arr = data._members[i]._user_roles;
        var join_value = arr.join(' | ');
        for(var j=0;j<arr.length;j++)
        {
            var role_lower = data._members[i]._user_roles[j];
            role_lower = role_lower.toLowerCase();
            if(role_lower == validate_filter)
               valid_type = 'yes';
        }
        $(cust_agent_type).html(join_value);
        $(name_col).append(cust_agent_type);
        $(chat_row).append(name_col);
        if(status_value_lower == status_value)
          $('#select_chat_widget').append(chat_row);
        /*else if(validate_filter == 'all' && status_value_lower == status_value)
           $('#select_chat_widget').append(chat_row); */
        var online_length = $('.online').length;
        var offline_length = $('.offline').length;
        var unavailable_length = $('.unavailable').length;
        $('#online_count_span').html(online_length);
        $('#offline_count_span').html(offline_length);
        $('#unavailable_count_span').html(unavailable_length);
    }
}

function selected_role_handler()
{
   var selected_value = $('#filter_type').val();
   var validate_filter = selected_value.toLowerCase();
   if(validate_filter == 'all')
   {
       chat_widget_handler();
       return false;
   }
   $('#select_chat_widget').html('');
   var online_count = 0;
    var offline_count = 0;
    var unavailable_count = 0;
    for (var i = 0; i < data._members.length; i++) 
    {
        var chat_row = document.createElement('div');
        $(chat_row).addClass('row chat');
        var img_col = document.createElement('div');
        $(img_col).addClass('col-md-2 col-lg-2 img_col');
        var img_element = document.createElement('img');
        $(img_element).addClass('img-circle img-responsive img-center chat_img');
        $(img_element).attr('src', data._members[i]._avatar);
        $(img_col).append(img_element);
        var parent_circle = document.createElement('div');
        $(parent_circle).addClass('parent_circle_round');
        $(img_col).append(parent_circle);
        var circle_element = document.createElement('div');
        $(circle_element).addClass('circle_round');
        if(data._members[i]._status == 'ONLINE')
        {
            online_count++;
            $(circle_element).addClass('online');
        }
        else if(data._members[i]._status == 'OFFLINE')
        {
            offline_count++;
            $(circle_element).addClass('offline');
        }
        else if(data._members[i]._status == 'INACTIVE')
        { 
             unavailable_count++;
             $(circle_element).addClass('unavailable');
        }
        $(img_col).append(circle_element);
        $(chat_row).append(img_col);
        var name_col = document.createElement('div');
        $(name_col).addClass('col-md-10 col-lg-10 name_col');
        var cust_name_row = document.createElement('div');
        $(cust_name_row).addClass('row cust_chat_name');
        $(cust_name_row).html(data._members[i]._name);
        $(name_col).append(cust_name_row);
        var cust_agent_type = document.createElement('div');
        $(cust_agent_type).addClass('row cust_chat_agent');
        var valid_type = 'no';
        var arr = data._members[i]._user_roles;
        var join_value = arr.join(' | ');
        for(var j=0;j<arr.length;j++)
        {
            var role_lower = data._members[i]._user_roles[j];
            role_lower = role_lower.toLowerCase();
            if(role_lower == validate_filter)
               valid_type = 'yes';
        }
        
        $(cust_agent_type).html(join_value);
        $(name_col).append(cust_agent_type);
        $(chat_row).append(name_col);
        if(valid_type == 'yes')
          $('#select_chat_widget').append(chat_row);

        var online_length = $('.online').length;
        var offline_length = $('.offline').length;
        var unavailable_length = $('.unavailable').length;
        $('#online_count_span').html(online_length);
        $('#offline_count_span').html(offline_length);
        $('#unavailable_count_span').html(unavailable_length);
       /* offline_click_value = 'yes';
       online_click_value = 'yes';
       unavailable_click_value = 'yes';  */
    }
} // selected role handler fnctn endng

function activity_handler()
{
  var status_value = $(this).data('status');
  var color_status = $(this).data('activecolor');
  $(this).css('backgroundColor', 'white');
  if(status_value == 'online' &&  online_click_value == 'yes')
  {
      $('#online_count_span').css('color', '#67D233');
      $('#online_count_span').attr('data-activecolor', 'no');
      online_click_value = 'no';  
      selected_filter_handler(status_value);
  }
  else if(status_value == 'online' &&  online_click_value == 'no')
  {
      $('#online_count_span').css('color', 'white');
      $('#online_count_span').css('backgroundColor', '#67D233');
      online_click_value = 'yes';
      offline_click_value = 'yes'; 
      unavailable_click_value = 'yes'; 
      $('#online_count_span').attr('data-activecolor', 'yes');
      chat_widget_handler();
     // selected_role_handler();
  }
  else if(status_value == 'offline' && offline_click_value == 'yes')
  {
      $('#offline_count_span').css('color', '#FF6662');
      $('#offline_count_span').attr('data-activecolor', 'no');
      offline_click_value = 'no'; 
      selected_filter_handler(status_value);
  }
  else if(status_value == 'offline' && offline_click_value == 'no')
  {
      $('#offline_count_span').css('color', 'white');
      $('#offline_count_span').css('backgroundColor', '#FF6662');
      offline_click_value = 'yes';
       online_click_value = 'yes';
       unavailable_click_value = 'yes'; 
      $('#offline_count_span').attr('data-activecolor', 'yes');
     // selected_role_handler();
     chat_widget_handler();
  }
  else if(status_value == 'unavailable' && unavailable_click_value == 'yes')
  {
      $('#unavailable_count_span').css('color', '#333333');
      $('#unavailable_count_span').attr('data-activecolor', 'no');
      unavailable_click_value = 'no';
      selected_filter_handler(status_value);
  }
  else if(status_value == 'unavailable' && unavailable_click_value == 'no')
  {
      $('#unavailable_count_span').css('color', 'white');
      $('#unavailable_count_span').css('backgroundColor', '#333333');
      unavailable_click_value = 'yes';
      online_click_value = 'yes';
      offline_click_value = 'yes'; 
      $('#unavailable_count_span').attr('data-activecolor', 'yes');
      chat_widget_handler();
     // selected_role_handler();
  }
} // fnctn endng

function chat_widget_handler() 
{
    $('#chat_widget').html('');
    unavailable_click_value = 'yes';
      online_click_value = 'yes';
      offline_click_value = 'yes'; 
    var role_array=['All', 'Manager', 'Agent'];
    var chat_widget_row = document.createElement('div');
    $(chat_widget_row).addClass('row');
    var members_row = document.createElement('div');
    $(members_row).addClass('row');
    var members_col = document.createElement('div');
    $(members_col).addClass('col-md-6 col-lg-6 mem_count');
    $(members_col).html('Members (' + data._members.length + ')');
    $(members_row).append(members_col);
    var member_btn_col = document.createElement('div');
    $(member_btn_col).addClass('col-md-6 col-lg-6 mem_btn');
    $(member_btn_col).html('Add Members');
    $(members_row).append(member_btn_col);
    $(chat_widget_row).append(members_row);
    var count_row = document.createElement('div');
    $(count_row).addClass('row count_cat');
    var online_count_col = document.createElement('div');
    $(online_count_col).addClass('col-md-3 col-lg-3');
    var online_span = document.createElement('div');
    $(online_span).addClass('online_circle active_count');
    $(online_span).attr('id', 'online_count_span');
    $(online_span).attr('data-activecolor', 'yes');
    $(online_span).attr('data-status', 'online');
    $(online_span).on('click', activity_handler);
    $(online_count_col).append(online_span);
    $(count_row).append(online_count_col);
    var offline_count_col = document.createElement('div');
    $(offline_count_col).addClass('col-md-3 col-lg-3');
    var offline_span = document.createElement('div');
    $(offline_span).addClass('offline_circle active_count');
    $(offline_span).attr('data-activecolor', 'yes');
    $(offline_span).attr('data-status', 'offline');
    $(offline_span).on('click', activity_handler);
    $(offline_span).attr('id', 'offline_count_span');
    $(offline_count_col).append(offline_span);
    $(count_row).append(offline_count_col);
    var unavailable_count_col = document.createElement('div');
    $(unavailable_count_col).addClass('col-md-3 col-lg-3');
    var unavailable_span = document.createElement('div');
    $(unavailable_span).addClass('unavailable_circle active_count');
    $(unavailable_span).attr('data-activecolor', 'yes');
    $(unavailable_span).attr('data-status', 'unavailable');
    $(unavailable_span).on('click', activity_handler);
    $(unavailable_span).attr('id', 'unavailable_count_span');
    $(unavailable_count_col).append(unavailable_span);
    $(count_row).append(unavailable_count_col);
    var all_dropdown_col = document.createElement('div');
    $(all_dropdown_col).addClass('col-md-3 col-lg-3 all_dropdown');
    var select_element = document.createElement('select');
    $(select_element).attr('id', 'filter_type');
    $(select_element).on('click', selected_role_handler);
    for(var i=0;i<role_array.length;i++)
    {
      var option_value = document.createElement('option');
      $(option_value).attr('value', role_array[i]);
      $(option_value).html(role_array[i]);
      $(select_element).append(option_value);
    } // for roles array endng
    $(all_dropdown_col).append(select_element);
    $(count_row).append(all_dropdown_col);
    $(chat_widget_row).append(count_row);
    var type_select_chat_widget = document.createElement('div');
    $(type_select_chat_widget).addClass('row');
    $(type_select_chat_widget).attr('id', 'select_chat_widget');
    var online_count = 0;
    var offline_count = 0;
    var unavailable_count = 0;
    for (var i = 0; i < data._members.length; i++) 
    {
        var chat_row = document.createElement('div');
        $(chat_row).addClass('row chat');
        var img_col = document.createElement('div');
        $(img_col).addClass('col-md-2 col-lg-2 img_col');
        var img_element = document.createElement('img');
        $(img_element).addClass('img-circle img-responsive img-center chat_img');
        $(img_element).attr('src', data._members[i]._avatar);
        $(img_col).append(img_element);
        var parent_circle = document.createElement('div');
        $(parent_circle).addClass('parent_circle_round');
        $(img_col).append(parent_circle);
        var circle_element = document.createElement('div');
        $(circle_element).addClass('circle_round');
        if(data._members[i]._status == 'ONLINE')
        {
            online_count++;
            $(circle_element).addClass('online');
        }
        else if(data._members[i]._status == 'OFFLINE')
        {
            offline_count++;
            $(circle_element).addClass('offline');
        }
        else if(data._members[i]._status == 'INACTIVE')
        { 
             unavailable_count++;
             $(circle_element).addClass('unavailable');
        }
        $(img_col).append(circle_element);
        $(chat_row).append(img_col);
        var name_col = document.createElement('div');
        $(name_col).addClass('col-md-10 col-lg-10 name_col');
        var cust_name_row = document.createElement('div');
        $(cust_name_row).addClass('row cust_chat_name');
        $(cust_name_row).html(data._members[i]._name);
        $(name_col).append(cust_name_row);
        var cust_agent_type = document.createElement('div');
        $(cust_agent_type).addClass('row cust_chat_agent');
        var arr = data._members[i]._user_roles;
        var join_value = arr.join(' | ');
        $(cust_agent_type).html(join_value);
        $(name_col).append(cust_agent_type);
        $(chat_row).append(name_col);
        $(type_select_chat_widget).append(chat_row);
    }
    $(chat_widget_row).append(type_select_chat_widget);
    $(online_span).html(online_count);
    $(offline_span).html(offline_count);
    $(unavailable_span).html(unavailable_count);
    $('#chat_widget').append(chat_widget_row);
}  //fnctn endng

function initialize() {
    var map;
    var bounds = new google.maps.LatLngBounds();
   /* var mapOptions = {
        mapTypeId: 'roadmap',
        zoom : 19,
        center: new google.maps.LatLng(mapping_details.mapCentre.lattitude, mapping_details.mapCentre.longitude)
        //center: new google.maps.LatLng(12.9988212,77.6410099)
    };

    // Display a map on the page
    map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
    map.setTilt(45); */

    // Display multiple markers on a map
    var infoWindow = new google.maps.InfoWindow(), marker, i;

    // Loop through our array of markers & place each one on the map
    for( i = 0; i < data._members.length; i++ ) 
    {
        //console.log(data._members[i]._last_location);
      if(data._members[i]._last_location != null && data._members[i]._last_location != undefined && data._members[i]._last_location != '')
      {
          //console.log(data._members[i]._last_location[0]);
        var position = new google.maps.LatLng(data._members[i]._last_location[0], data._members[i]._last_location[1]);
        bounds.extend(position);
        marker = new google.maps.Marker({
            position: position,
            map: map,
            title: data._members[i]._name
        });
       } // if 
        // Allow each marker to have an info window
       /* google.maps.event.addListener(marker, 'click', (function(marker, i) {
            return function() {
                 if (mapping_details.labsGPSData[i].distanceFromCentre != undefined)
                  infoWindow.setContent("<div><a href="+mapping_details.labsGPSData[i].labPageURL + " target='_blank'><h3>"+mapping_details.labsGPSData[i].name+"</h3><p>"+mapping_details.labsGPSData[i].area+', '+mapping_details.labsGPSData[i].city+' ( '+mapping_details.labsGPSData[i].distanceFromCentre+' Km )'+"</p></a></div>");
                else
                  infoWindow.setContent("<div><a href="+mapping_details.labsGPSData[i].labPageURL + " target='_blank'><h3>"+mapping_details.labsGPSData[i].name+"</h3><p>"+mapping_details.labsGPSData[i].area+', '+mapping_details.labsGPSData[i].city+"</p></a></div>");
                infoWindow.open(map, marker);
            }
        })(marker, i)); */

        // Automatically center the map fitting all markers on the screen
        //map.fitBounds(bounds);
    }
      var image = 'http://maps.google.com/mapfiles/ms/icons/green-dot.png';

  /*  var position = new google.maps.LatLng(mapping_details.mapCentre.lattitude, mapping_details.mapCentre.longitude);
        bounds.extend(position);
        marker = new google.maps.Marker({
            position: position,
            map: map,
            icon: image,
            title: mapping_details.mapCentre.name
       }); */

      /*google.maps.event.addListener(marker, 'click', (function(marker, i) {
            return function() {
                  infoWindow.setContent("<div><p class='centre_icon'>"+mapping_details.mapCentre.centreTitle+"</p></div>");
                infoWindow.open(map, marker);
            }
        })(marker, i)); */
    // Override our map zoom level once our fitBounds function runs (Make sure it only runs once)
     var boundsListener = google.maps.event.addListener((map), 'bounds_changed', function(event) {
        this.setZoom(mapping_details.zoomLevel);
        google.maps.event.removeListener(boundsListener);
    });

}

console.log(data);

window.onload = chat_widget_handler();

