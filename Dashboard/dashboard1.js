var data = {
    "_organization_logo": "https://s3-ap-southeast-1.amazonaws.com/com.loktra.avatars/u_bony@loktra.com",
    "_current_user":  {
        "_avatar": "https://s3-ap-southeast-1.amazonaws.com/com.loktra.avatars/u_bony@loktra.com",
        "_email": "bony@loktra.com",
        "_employee_id": "E103",
        "_id": "b5b7b5e1-9101-4526-995f-b93fe2142b60",
        "_joined_since": "2016-12-26T13:34:34.784013Z",
        "_joined_since_date": "Dec 26 2016",
        "_name": "Bony Roopchandani",
        "_phone": "+918233085557",
        "_user_roles": [
          "manager",
          "agent"
        ]
    },
    "_members": [
        {
            "_id": "118e2390-6efb-4ca5-960c-736408738378",
            "_name": "Bishwash Kumara",
            "_avatar": "https://s3-ap-southeast-1.amazonaws.com/com.loktra.avatars/u_bony@loktra.com",
            "_user_roles": [
              "agent"
            ],
            "_status": "ONLINE",
            "_last_location": [12.9567083, 77.709295]
        },
        {
            "_id": "118e2390-6efb-4ca5-960c-736408738378",
            "_name": "Stephen McCurry",
            "_avatar": "https://s3-ap-southeast-1.amazonaws.com/com.loktra.avatars/u_bony@loktra.com",
            "_user_roles": [
              "agent"
            ],
            "_status": "INACTIVE",
            "_last_location": null
        },
        {
            "_id": "118e2390-6efb-4ca5-960c-736408738378",
            "_name": "Tania Saha",
            "_avatar": null,
            "_user_roles": [
              "agent"
            ],
            "_status": "OFFLINE",
            "_last_location": [12.9567083, 77.709295]
        },
        {
            "_id": "118e2390-6efb-4ca5-960c-736408738378",
            "_name": "Ajaykumar Srinivas",
            "_avatar": "https://s3-ap-southeast-1.amazonaws.com/com.loktra.avatars/u_bony@loktra.com",
            "_user_roles": [
              "manager",
              "agent"
            ],
            "_status": "INACTIVE",
            "_last_location": null
        },
        {
            "_id": "118e2390-6efb-4ca5-960c-736408738378",
            "_name": "Srinivas Manjunathan",
            "_avatar": null,
            "_user_roles": [
              "manager",
              "agent",
              "admin"
            ],
            "_status": "ONLINE",
            "_last_location": [12.9567083, 77.709295]
        }
    ],
    "_tasks": {
        "_count": {
            "_total": 10,
            "_assigned": 7,
            "_unassigned": 3
        },
        "_list": {
            "_assigned": [
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "PENDING",
                    "_customer": {
                        "_id": "118e2390-6efb-4ca5-960c-736408738378",
                        "_name": "Mr. Naresh Kumar Singh",
                        "_address": "12th Main, Koramangala, Bangalore, 560093",
                        "_phone": "+919090909090",
                        "_customer_id": "ABC123",
                        "_location": [12.9567083, 77.709295]
                    }
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "FAILED",
                    "_customer": {
                        "_id": "118e2390-6efb-4ca5-960c-736408738378",
                        "_name": "Mr. Naresh Kumar Singh",
                        "_address": "12th Main, Koramangala, Bangalore, 560093",
                        "_phone": "+919090909090",
                        "_customer_id": "ABC123",
                        "_location": null
                    }
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "COMPLETED",
                    "_customer": {
                        "_id": "118e2390-6efb-4ca5-960c-736408738378",
                        "_name": "Mr. Naresh Kumar Singh",
                        "_address": "12th Main, Koramangala, Bangalore, 560093",
                        "_phone": "+919090909090",
                        "_customer_id": "ABC123",
                        "_location": null
                    }
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "FAILED",
                    "_customer": {
                        "_id": "118e2390-6efb-4ca5-960c-736408738378",
                        "_name": "Mr. Naresh Kumar Singh",
                        "_address": "12th Main, Koramangala, Bangalore, 560093",
                        "_phone": "+919090909090",
                        "_customer_id": "ABC123",
                        "_location": [12.9567083, 77.709295]
                    }
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "STARTED",
                    "_customer": {
                        "_id": "118e2390-6efb-4ca5-960c-736408738378",
                        "_name": "Mr. Naresh Kumar Singh",
                        "_address": "12th Main, Koramangala, Bangalore, 560093",
                        "_phone": "+919090909090",
                        "_customer_id": "ABC123",
                        "_location": null
                    }
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "PENDING",
                    "_customer": {
                        "_id": "118e2390-6efb-4ca5-960c-736408738378",
                        "_name": "Mr. Naresh Kumar Singh",
                        "_address": "12th Main, Koramangala, Bangalore, 560093",
                        "_phone": "+919090909090",
                        "_customer_id": "ABC123",
                        "_location": [12.9567083, 77.709295]
                    }
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "FAILED",
                    "_customer": {
                        "_id": "118e2390-6efb-4ca5-960c-736408738378",
                        "_name": "Mr. Naresh Kumar Singh",
                        "_address": "12th Main, Koramangala, Bangalore, 560093",
                        "_phone": "+919090909090",
                        "_customer_id": "ABC123",
                        "_location": null
                    }
                }
            ],
            "_unassigned": [
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "PENDING",
                    "_customer": {
                        "_id": "118e2390-6efb-4ca5-960c-736408738378",
                        "_name": "Mr. Naresh Kumar Singh",
                        "_address": "12th Main, Koramangala, Bangalore, 560093",
                        "_phone": "+919090909090",
                        "_customer_id": "ABC123",
                        "_location": null
                    }
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "PENDING",
                    "_customer": {
                        "_id": "118e2390-6efb-4ca5-960c-736408738378",
                        "_name": "Mr. Naresh Kumar Singh",
                        "_address": "12th Main, Koramangala, Bangalore, 560093",
                        "_phone": "+919090909090",
                        "_customer_id": "ABC123",
                        "_location": [12.9567083, 77.709295]
                    }
                },
                {
                    "_id": "118e2390-6efb-4ca5-960c-736408738378",
                    "_name": "ABC Company marketing",
                    "_agent": "Naresh Rathod",
                    "_status": "PENDING",
                    "_customer": {
                        "_id": "118e2390-6efb-4ca5-960c-736408738378",
                        "_name": "Mr. Naresh Kumar Singh",
                        "_address": "12th Main, Koramangala, Bangalore, 560093",
                        "_phone": "+919090909090",
                        "_customer_id": "ABC123",
                        "_location": null
                    }
                }
            ]
        }
    },
    "_navigation_details": {
        "_default_path": {
            "_default_group_path": {
                "_id": "118e2390-6efb-4ca5-960c-736408738378",
                "_name": "Sales"
            },
            "_default_place_path": {
                "_id": "118e2390-6efb-4ca5-960c-736408738378",
                "_name": "Pan India"
            },
        },
    }
};

var color_status_value = '';
var click_online_value = 'yes';
var click_offline_value = 'yes';
var click_inactive_value = 'yes';
var map;

function selected_role_handler(status_value)
{
   var selected_value = $('#filter_type').val();
   var validate_filter = selected_value.toLowerCase();
  /* if(validate_filter == 'all')
   {
       chat_widget_handler();
       return false;
   } */
   $('#select_chat_widget').html('');
   var online_count = 0;
    var offline_count = 0;
    var unavailable_count = 0;
    for (var i = 0; i < data._members.length; i++) 
    {
        var chat_row = document.createElement('div');
        $(chat_row).addClass('row chat');
        var img_col = document.createElement('div');
        $(img_col).addClass('col-md-2 col-lg-2 img_col');
        var img_element = document.createElement('img');
        $(img_element).addClass('img-circle img-responsive img-center chat_img');
        $(img_element).attr('src', data._members[i]._avatar);
        $(img_col).append(img_element);
        var parent_circle = document.createElement('div');
        $(parent_circle).addClass('parent_circle_round');
        $(img_col).append(parent_circle);
        var circle_element = document.createElement('div');
        $(circle_element).addClass('circle_round');
        var curr_status = data._members[i]._status;
        curr_status = curr_status.toLowerCase();
        if(data._members[i]._status == 'ONLINE')
        {
            online_count++;
            $(circle_element).addClass('online');
        }
        else if(data._members[i]._status == 'OFFLINE')
        {
            offline_count++;
            $(circle_element).addClass('offline');
        }
        else if(data._members[i]._status == 'INACTIVE')
        { 
             unavailable_count++;
             $(circle_element).addClass('unavailable');
        }
        $(img_col).append(circle_element);
        $(chat_row).append(img_col);
        var name_col = document.createElement('div');
        $(name_col).addClass('col-md-10 col-lg-10 name_col');
        var cust_name_row = document.createElement('div');
        $(cust_name_row).addClass('row cust_chat_name');
        $(cust_name_row).html(data._members[i]._name);
        $(name_col).append(cust_name_row);
        var cust_agent_type = document.createElement('div');
        $(cust_agent_type).addClass('row cust_chat_agent');
        var valid_type = 'no';
        var arr = data._members[i]._user_roles;
        var join_value = arr.join(' | ');
        for(var j=0;j<arr.length;j++)
        {
            var role_lower = data._members[i]._user_roles[j];
            role_lower = role_lower.toLowerCase();
            if(role_lower == validate_filter)
               valid_type = 'yes';
        }
        
        $(cust_agent_type).html(join_value);
        $(name_col).append(cust_agent_type);
        $(chat_row).append(name_col);
        console.log(status_value);
        if(status_value == '')
          curr_status = '';
        /* if(valid_type == 'yes')
          $('#select_chat_widget').append(chat_row); */
        if(validate_filter == 'all' && status_value == curr_status)
        {
            $('#select_chat_widget').append(chat_row);
        }
        else if(valid_type == 'yes' && status_value == curr_status)
        {
          $('#select_chat_widget').append(chat_row);
        }
        var online_length = $('.online').length;
        var offline_length = $('.offline').length;
        var unavailable_length = $('.unavailable').length;
        $('#online_count_span').html(online_length);
        $('#offline_count_span').html(offline_length);
        $('#unavailable_count_span').html(unavailable_length);
    }
} // selected role handler fnctn endng

function activity_handler()
{
   var curr_status_value = $(this).data('status');
   $(this).css('backgroundColor', 'white');
  // console.log(curr_status_value);
   if(curr_status_value == 'online' &&  click_online_value == 'yes')
   {
      $('#online_count_span').css('color', '#67D233');
      $('#online_count_span').css('backgroundColor', 'white');
      $('#offline_count_span').css('color', 'white');
      $('#offline_count_span').css('backgroundColor', '#FF6662');
      $('#unavailable_count_span').css('color', 'white');
      $('#unavailable_count_span').css('backgroundColor', '#333333');
      var status_value = curr_status_value;
      click_online_value = 'no';
      click_offline_value = 'yes';
      click_inactive_value = 'yes';
      selected_role_handler(status_value);
   } //if
   else if(curr_status_value == 'online' &&  click_online_value == 'no')
   {
      $('#online_count_span').css('color', 'white');
      $('#online_count_span').css('backgroundColor', '#67D233');
      var status_value = curr_status_value;
      click_online_value = 'yes';
      status_value = '';
      selected_role_handler(status_value);
   } //if
   if(curr_status_value == 'offline' &&  click_offline_value == 'yes')
   {
      $('#online_count_span').css('backgroundColor', '#67D233');
      $('#online_count_span').css('color', 'white');
      $('#offline_count_span').css('color', '#FF6662');
      $('#offline_count_span').css('backgroundColor', 'white');
      $('#unavailable_count_span').css('color', 'white');
      $('#unavailable_count_span').css('backgroundColor', '#333333');
      var status_value = curr_status_value;
      click_offline_value = 'no';
      click_inactive_value = 'yes';
      click_online_value = 'yes';
      selected_role_handler(status_value);
   } //if
   else if(curr_status_value == 'offline' &&  click_offline_value == 'no')
   {
      $('#offline_count_span').css('color', 'white');
      $('#offline_count_span').css('backgroundColor', '#FF6662');
      var status_value = curr_status_value;
      click_offline_value = 'yes';
      status_value = '';
      selected_role_handler(status_value);
   } //if
   if(curr_status_value == 'inactive' &&  click_inactive_value == 'yes')
   {
      $('#online_count_span').css('backgroundColor', '#67D233');
      $('#online_count_span').css('color', 'white');
      $('#offline_count_span').css('backgroundColor', '#FF6662');
      $('#offline_count_span').css('color', 'white');
      $('#unavailable_count_span').css('color', '#333333');
      $('#unavailable_count_span').css('backgroundColor', 'white');
      var status_value = curr_status_value;
      click_inactive_value = 'no';
      click_online_value = 'yes';
      click_offline_value = 'yes';
      selected_role_handler(status_value);
   } //if
   else if(curr_status_value == 'inactive' &&  click_inactive_value == 'no')
   {
      $('#unavailable_count_span').css('color', 'white');
      $('#unavailable_count_span').css('backgroundColor', '#333333');
      var status_value = curr_status_value;
      click_inactive_value = 'yes';
      status_value = '';
      selected_role_handler(status_value);
   } //if
}

function chat_widget_handler() 
{
    map_builder();
    $('#chat_widget').html('');
    unavailable_click_value = 'yes';
    online_click_value = 'yes';
    offline_click_value = 'yes'; 
    var role_array=['All', 'Manager', 'Agent'];
    var chat_widget_row = document.createElement('div');
    $(chat_widget_row).addClass('row');
    var members_row = document.createElement('div');
    $(members_row).addClass('row');
    var members_col = document.createElement('div');
    $(members_col).addClass('col-md-6 col-lg-6 mem_count');
    $(members_col).html('Members (' + data._members.length + ')');
    $(members_row).append(members_col);
    var member_btn_col = document.createElement('div');
    $(member_btn_col).addClass('col-md-6 col-lg-6 mem_btn');
    $(member_btn_col).html('Add Members');
    $(members_row).append(member_btn_col);
    $(chat_widget_row).append(members_row);
    var count_row = document.createElement('div');
    $(count_row).addClass('row count_cat');
    var online_count_col = document.createElement('div');
    $(online_count_col).addClass('col-md-3 col-lg-3');
    var online_span = document.createElement('div');
    $(online_span).addClass('online_circle active_count');
    $(online_span).attr('id', 'online_count_span');
    $(online_span).attr('data-status', 'online');
    $(online_span).on('click', activity_handler);
    $(online_count_col).append(online_span);
    $(count_row).append(online_count_col);
    var offline_count_col = document.createElement('div');
    $(offline_count_col).addClass('col-md-3 col-lg-3');
    var offline_span = document.createElement('div');
    $(offline_span).addClass('offline_circle active_count');
    $(offline_span).attr('data-status', 'offline');
    $(offline_span).on('click', activity_handler);
    $(offline_span).attr('id', 'offline_count_span');
    $(offline_count_col).append(offline_span);
    $(count_row).append(offline_count_col);
    var unavailable_count_col = document.createElement('div');
    $(unavailable_count_col).addClass('col-md-3 col-lg-3');
    var unavailable_span = document.createElement('div');
    $(unavailable_span).addClass('unavailable_circle active_count');
    $(unavailable_span).attr('data-status', 'inactive');
    $(unavailable_span).on('click', activity_handler);
    $(unavailable_span).attr('id', 'unavailable_count_span');
    $(unavailable_count_col).append(unavailable_span);
    $(count_row).append(unavailable_count_col);
    var all_dropdown_col = document.createElement('div');
    $(all_dropdown_col).addClass('col-md-3 col-lg-3 all_dropdown');
    var select_element = document.createElement('select');
    $(select_element).attr('id', 'filter_type');
    $(select_element).on('click', function()
    {
        var status_value = '';
      $('#online_count_span').css('backgroundColor', '#67D233');
      $('#online_count_span').css('color', 'white');
      $('#offline_count_span').css('backgroundColor', '#FF6662');
      $('#offline_count_span').css('color', 'white');
      $('#unavailable_count_span').css('backgroundColor', '#333333');
      $('#unavailable_count_span').css('color', 'white');
        selected_role_handler(status_value);
    });
    for(var i=0;i<role_array.length;i++)
    {
      var option_value = document.createElement('option');
      $(option_value).attr('value', role_array[i]);
      $(option_value).html(role_array[i]);
      $(select_element).append(option_value);
    } // for roles array endng
    $(all_dropdown_col).append(select_element);
    $(count_row).append(all_dropdown_col);
    $(chat_widget_row).append(count_row);
    var type_select_chat_widget = document.createElement('div');
    $(type_select_chat_widget).addClass('row');
    $(type_select_chat_widget).attr('id', 'select_chat_widget');
    var online_count = 0;
    var offline_count = 0;
    var unavailable_count = 0;
    for (var i = 0; i < data._members.length; i++) 
    {
        var chat_row = document.createElement('div');
        $(chat_row).addClass('row chat');
        var img_col = document.createElement('div');
        $(img_col).addClass('col-md-2 col-lg-2 img_col');
        var default_img = document.createElement('div');
        $(default_img).addClass('default_img');
        var default_value = data._members[i]._name;
        default_value = default_value.charAt(0);
        $(default_img).html(default_value);
        var img_element = document.createElement('img');
        $(img_element).addClass('img-circle img-responsive img-center chat_img');
        $(img_element).attr('src', data._members[i]._avatar);
        if(data._members[i]._avatar != null && data._members[i]._avatar != undefined && data._members[i]._avatar != '')
            $(img_col).append(img_element);
        else
           $(img_col).append(default_img);
        var parent_circle = document.createElement('div');
        $(parent_circle).addClass('parent_circle_round');
        $(img_col).append(parent_circle);
        var circle_element = document.createElement('div');
        $(circle_element).addClass('circle_round');
        if(data._members[i]._status == 'ONLINE')
        {
            online_count++;
            $(circle_element).addClass('online');
        }
        else if(data._members[i]._status == 'OFFLINE')
        {
            offline_count++;
            $(circle_element).addClass('offline');
        }
        else if(data._members[i]._status == 'INACTIVE')
        { 
             unavailable_count++;
             $(circle_element).addClass('unavailable');
        }
        $(img_col).append(circle_element);
        $(chat_row).append(img_col);
        var name_col = document.createElement('div');
        $(name_col).addClass('col-md-10 col-lg-10 name_col');
        var cust_name_row = document.createElement('div');
        $(cust_name_row).addClass('row cust_chat_name');
        $(cust_name_row).html(data._members[i]._name);
        $(name_col).append(cust_name_row);
        var cust_agent_type = document.createElement('div');
        $(cust_agent_type).addClass('row cust_chat_agent');
        var arr = data._members[i]._user_roles;
        var join_value = arr.join(' | ');
        $(cust_agent_type).html(join_value);
        $(name_col).append(cust_agent_type);
        $(chat_row).append(name_col);
        $(type_select_chat_widget).append(chat_row);
    }
    $(chat_widget_row).append(type_select_chat_widget);
    $(online_span).html(online_count);
    $(offline_span).html(offline_count);
    $(unavailable_span).html(unavailable_count);
    $('#chat_widget').append(chat_widget_row);
}  //fnctn endng
console.log(data);

function map_builder()
{
    var script = document.createElement('script');
    script.src = "http://maps.googleapis.com/maps/api/js?sensor=false&key=AIzaSyC2ySW0Z3bOeNKTwfD1QVV_6DS0RbFWTWg&callback=initMap";
    document.body.appendChild(script);
}

 function initMap() {
     var locations =[];
     //var labels =[];
     for( i = 0; i < data._members.length; i++ ) 
    {
        //console.log(data._members[i]._last_location);
      if(data._members[i]._last_location != null && data._members[i]._last_location != undefined && data._members[i]._last_location != '')
      {
          //console.log(data._members[i]._last_location[0]);
         // labels.push(data._members[i]._avatar);
          locations.push({lat:data._members[i]._last_location[0], lng:data._members[i]._last_location[1]});
        
       } // if 
    }
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 3,
          center: {lat:12.9988212, lng:77.6410099}
        });
  var locations = [
  {lat: -31.563910, lng: 147.154312},
  {lat: -33.718234, lng: 150.363181},
  {lat: -33.727111, lng: 150.371124},
  {lat: -33.848588, lng: 151.209834},
  {lat: -33.851702, lng: 151.216968},
  {lat: -34.671264, lng: 150.863657},
  {lat: -35.304724, lng: 148.662905},
  {lat: -36.817685, lng: 175.699196},
  {lat: -36.828611, lng: 175.790222},
  {lat: -37.750000, lng: 145.116667},
  {lat: -37.759859, lng: 145.128708},
  {lat: -37.765015, lng: 145.133858},
  {lat: -37.770104, lng: 145.143299},
  {lat: -37.773700, lng: 145.145187},
  {lat: -37.774785, lng: 145.137978},
  {lat: -37.819616, lng: 144.968119},
  {lat: -38.330766, lng: 144.695692},
  {lat: -39.927193, lng: 175.053218},
  {lat: -41.330162, lng: 174.865694},
  {lat: -42.734358, lng: 147.439506},
  {lat: -42.734358, lng: 147.501315},
  {lat: -42.735258, lng: 147.438000},
  {lat: -43.999792, lng: 170.463352}
]; 
        // Create an array of alphabetical characters used to label the markers.
         var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

        // Add some markers to the map.
        // Note: The code uses the JavaScript Array.prototype.map() method to
        // create an array of markers based on a given "locations" array.
        // The map() method here has nothing to do with the Google Maps API.
       /* var markers = new google.maps.Marker({
        for( i = 0; i < data._members.length; i++ ) 
        {
          if(data._members[i]._last_location != null && data._members[i]._last_location != undefined && data._members[i]._last_location != '')
         {
          //console.log(data._members[i]._last_location[0]);
          var position = new google.maps.LatLng(data._members[i]._last_location[0], data._members[i]._last_location[1]);
          bounds.extend(position);
          markers = new google.maps.Marker({
            position: position,
            map: map,
            title: data._members[i]._name,
        });
       } // if 
        }); */
        var markers = locations.map(function(location, i) {
          return new google.maps.Marker({
            position: location,
            label: labels[i % labels.length]
          });
        });

        // Add a marker clusterer to manage the markers.
        var markerCluster = new MarkerClusterer(map, markers,
            {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
      }
      

function initialize() {
    var map;
    var bounds = new google.maps.LatLngBounds();
    var mapOptions = {
        mapTypeId: 'roadmap',
        zoom : 19,
        //center: new google.maps.LatLng(mapping_details.mapCentre.lattitude, mapping_details.mapCentre.longitude)
        center: new google.maps.LatLng(12.9988212,77.6410099)
    };

    // Display a map on the page
    map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
    //map.setTilt(45); 

    // Display multiple markers on a map
    var infoWindow = new google.maps.InfoWindow(), marker, i;
    var image = 'http://maps.google.com/mapfiles/ms/icons/green-dot.png';
    // Loop through our array of markers & place each one on the map
    for( i = 0; i < data._members.length; i++ ) 
    {
        //console.log(data._members[i]._last_location);
      if(data._members[i]._last_location != null && data._members[i]._last_location != undefined && data._members[i]._last_location != '')
      {
          //console.log(data._members[i]._last_location[0]);
        var position = new google.maps.LatLng(data._members[i]._last_location[0], data._members[i]._last_location[1]);
        bounds.extend(position);
        marker = new google.maps.Marker({
            position: position,
            map: map,
            title: data._members[i]._name,
            icon: image
        });
       } // if 
       
    }

    // Override our map zoom level once our fitBounds function runs (Make sure it only runs once)
     var boundsListener = google.maps.event.addListener((map), 'bounds_changed', function(event) {
       // this.setZoom(mapping_details.zoomLevel);
        google.maps.event.removeListener(boundsListener);
    });
     
}

window.onload = chat_widget_handler();

